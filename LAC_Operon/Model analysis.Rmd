---
title: "Model analysis"
subtitle: "Non Linear Dynamics"
author: "Frederik Espersen Knudsen"
date: "2022-11-11"
output: pdf_document
---

# LAC Operon Model analysis
Based on Yildirim et al. 2004.  

See repository for more information.  

## Setup

```{r}
library(tidyverse)
library(broom)
options(scipen=999)
```


## Models with one starting condition
### Loading simulation results
Loading data into dataframes
```{r message=FALSE, warning=FALSE}
original = read_csv("results/Original model 2022-11-11 02:41:58.csv")
corrected = read_csv("results/Corrected model 2022-11-11 02:42:02.csv")
```
  
Combining into one DF  
```{r}
data <-
  bind_rows(original %>% mutate(Model = "Original"), corrected %>% mutate(Model = "Corrected"))
```
  
Scaling and pivoting data  
```{r}
data <-
  data %>%
  mutate(across(-c(Time, Model), scale)) %>%
  pivot_longer(cols = -c(Time, Model), names_to="Species", values_to="Concentration") %>%
  mutate(across(c(Model, Species), as.factor))
```

### Visualising results
```{r}
ggplot(data %>% mutate(Species.Model = paste(Species, Model, delimiter=".")), aes(x=Time, y=Concentration, color=Species.Model)) +
  geom_line() +
  #scale_y_log10() +
  theme_classic()
```


### Model analysis
Checking hypothesis: There is no significant difference between the data measured with either model.
```{r}
data %>%
  group_by(Species) %>%
  nest() %>%
  mutate(F_test = map(data, ~ aov(Concentration ~ Model + Time, data = .x) %>% tidy() %>% pluck("p.value", 1))) %>%
  unnest(F_test) %>%
  select(-data)
```


## Models with a scan of starting conditions
### Loading simulation results
Loading data into dataframes
```{r message=FALSE, warning=FALSE}
data <- read_csv("results/Starting conditions scan 2022-11-11 10:37:22.csv") %>%
  mutate(across(c(Model, Starting_Conditions_Set, L), as.factor))
```

### Visualising results
```{r}
data %>%
  pivot_longer(cols = -c(Time, Model, Starting_Conditions_Set, L), names_to="Species", values_to="Concentration") %>%
  mutate(across(c(Species), as.factor)) %>% 
  filter(Model == "Corrected") %>%
  ggplot(aes(x=Time, y=Concentration, color=Starting_Conditions_Set)) +
    geom_line(show.legend=F) +
    facet_grid(Species~L, scales="free_y") +
    scale_y_log10() +
    labs(title="Time progression curves for the three species for different Lactose concentrations [nM]") +
    xlab("Time [min]") +
    ylab("Concentration [nM]") +
    theme_classic()
```
```{r}
sim_end = max(data$Time)
data %>%
  pivot_longer(cols=c(M, B, A), names_to="Species", values_to="Concentration") %>%
  filter(Time == sim_end) %>%
  group_by(Species, L) %>%
  summarize(SteadyState=mean(Concentration)) %>%
  ggplot(aes(x=L, y=SteadyState, fill=L)) +
    geom_bar(stat="identity") +
    facet_wrap(~Species, scales="free_y") +
    theme_classic()
```



### Model analysis
Checking hypothesis: There is no significant difference between the data measured with either model.
```{r}
pivot_scaled_data %>%
  group_by(Species) %>%
  nest() %>%
  mutate(F_test = map(data, ~ aov(Concentration ~ Model + Time + L + Starting_Conditions_Set, data = .x) %>% tidy() %>% pluck("p.value", 1))) %>%
  unnest(F_test)
```